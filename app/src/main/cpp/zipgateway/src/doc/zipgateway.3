.\"	Added by aes
.\"
.TH ZIPGATEWAY 1 2013-03-20 "Linux" "SERVICES"
.SH NAME
zipgateway \- the Z-Wave to IP translator
.SH SYNOPSIS
.B zipgateway \- [-f log] [-e eeprom] [-s /dev/ttyXXX ] [-c cfgfile] [-t tunfile]
.SH DESCRIPTION
The Z/IP gateway is an application which allows internet clients to contact and control nodes in a Z-Wave network. Through the Z/IP gateway each node on the Z-Wave network behaves as an IP client on the network.

On boot the Z/IP gateway will create a TAP interface which is used to send and receive IP packages. The application has its own IPv4 and IPv6 stack. The gateway application will respond to IPv4 and IPv6 request on UDP port 4123, destined for itself and on behalf of all nodes in the Z-Wave network. IPv6 addresses are assigned according to the settings in the configuration file. Optionally the Z/IP Gateway will choose IPv6 addresses on its own. Provided there is a IPv4 DHCP server on the network, the Z/IP gateway will request IPv4 addresses for itself and all nodes in the Z-Wave network.

IPv4 addresses are requested via DHCP on the LAN interface, which mean they are all in the same subnet. This means that there in general is no need for setting up IPv4 routes. I no DHCP service is available IPv6 addresses may be used. IPv6 addresses are assigned in a separate subnet called the PAN(Personal Area Network) or HAN(Home area Network). This means that a IPv6 route must be setup, in order for clients to reach the PAN. This is achieved using the \fI/etc/zipgateway.tun\fR script. To ease the routing the Z/IP gateway will send out RFC4191 router announcements. Clients who support RFC4191 will be able to communicate with the PAN nodes via IPv6 without special routes. 

Optionally the Z/IP gateway may be configured to connect to a "portal". The portal connection is a IPv4 TLS tunnel, which transports IPv6 packages. The Z/IP gateway may be remotely configured through the portal. The portal pushed configuration overrides local configuration parameters.

For a full description see INS11863 which is distributed with the Z/IP SDK

.SH OPTIONS
The command line options will override the options in the configuration file.
.TP
\fB\-f logfile\fR
If this option is set, all communication between the Z-Wave module and the Z/IP Gateway application is logged into the logfile. Default behavior is no logging.
.TP
\fB\-e eeprom.dat\fR
The Z/IP Gateway needs a file to store learned network data. This file should be located on a writable non-volatile partition. The eeprom file will be generated if it does not exist. 
Defaults to .I /etc/eeprom.dat
.TP
\fB\-s /dev/ttyXXX\fR
The serial port to which the Z-Wave serial API is connected. The Serial API connected should be of the type "Bridge Library"
.TP
\fB\-c cfgfile\fR
The configuration file read by the application
Defaults to
.I /usr/local/etc/zipgateway.cfg
.TP
\fB\-t tunfile\fR
Location of the tunnel setup script
Defaults to
.I /usr/local/etc/zipgateway.tun

.SH FILES
.TP
.I eeprom.dat
Eeprom file, generated by the Z/IP Gateway

.TP
.I zipgateway.cfg
Configuration file, see the section below.

.TP
.I zipgateway.tun
Script which is run when the TAP interface of the Z/IP gateway comes up, and when the TAP interface goes down. The script is called with the keywords "up" and "down" when the interface status changes. Three environment variables are defined when the script is executed.

.B TUNDEV
The device name of the tunnel device.

.B LANIP
The IPv6 address of the Z/IP gateway's LAN interface.

.B HANPREFIX
The Ipv6 prefix of the Z-Wave networks. This is the address range in which the Z-Wave nodes are assigend IPv6 addresses.

The environment variables may be used to configure routes on the host and to bridge the TAP interface together with other network interfaces, and to setup proper routes to the PAN.
This script also configures wireless if the interface on which Z/IP Gateway is listening for Z/IP client requests and DHCP leases is wireless interface. Script configures various daemons to enable wireless Z/IP Gateway.

.SH CONFIGURATION FILE
.TP
The zipgateway configuration file is used to customize the Z/IP Gateway behavior. Entries in the configuration file is written in a simple key=value format. The = sign is used as a delimiter, everything to the left of the = is a key and everything on the right of the = is the value. The default location of the configuration file is /usr/local/etc/zipgateway.cfg

.TP
.B ZipSerialAPIPortName
Serial port device name. The connected serial API should the of the type "Static Controller"

.TP
.B ZipUnsolicitedDestinationIp6
An IPv6 address to send unsolicited commands to. Unsolicited commands are Z-Wave command classes which are 
not handled by the Z/IP gateway. This option makes it possible to extend the functionality of the Z/IP gateway, 
with a foreign back end program. The unsolicited destination MUST honer the AGI functionality described in the 
Z-Wave+ specification for a CSC. Then the Z/IP Gateway is inclusion controller the unsolicited destination must 
support "Device Reset Locally" and association. When the Gateway is SIS it the host must implement Lifeline setup
when adding new nodes. 
 

.TP
.B ZipUnsolicitedDestinationPort
Destination UDP port to use when sending unsolicited commands.
Default: 4123

.TP
.B ZipUnsolicitedDestination2Ip6
A secondary unsolicited destination. See ZipUnsolicitedDestinationIp6.

.TP
.B ZipUnsolicitedDestination2Port
A secondary unsolicited destination port. See ZipUnsolicitedDestinationPort.

.TP
.B SerialLog
Log file for serial communication. Used for debugging. If this option is not set the no logging is done.

.TP
.B ZipCaCert
CA certificate of the portal provider.
Default: /usr/local/etc/Portal.ca_x509.pem

.TP
.B ZipCert
Z/IP Gateway public certificate.
Default: /usr/local/etc/ZIPR.x509_1024.pem 

.TP
.B ZipPrivKey
Z/IP Gateway private key.
Default: /usr/local/etc/ZIPR.key_1024.pem 

.TP
.B Eepromfile
Location of eeprom file. The eeprom file must be stored in a non-volatile location 

.TP
.B TunScript
Location of the tun script.
Default: /usr/local/etc/zipgateway.tun

.TP
.B ZipPanIp6
IPv6 prefix of the Z-Wave network. All Z-Wave nodes will be assigned an IPv6 address in this prefix. The host system should make sure to establish a route to this prefix via the ZipLanIp6. The default value is the 0::0 address, which means that the Z/IP Gateway will auto create a ULA prefix for the Z-Wave network.

.TP
.B ZipLanIp6
The IPv6 address of the Z/IP Gateway. This is LAN IP6 address of the Z/IP Gateway. This is the address which should be used when communicating with the Z/IP Gateway. This address should also be the target address of the route to the Z-Wave network. If this address is the 0::0 address the Z/IP Gateway will auto-generate a ULA address.

.TP
.B ZipLanGw6
The IPv6 default gateway which the Z/IP Gateway will use, when sending outside the LAN or PAN.

.TP
.B ZipPortal
IPv4 address of the gateway portal. The portal is a sort of a VPN host which transports IPv6 packages inside a TLS encrypted TCP tunnel. If not set the Z/IP Gateway runs without a portal.

.TP
.B ZipPortalPort
TCP port to use when connecting to a remote portal.
Default: 44123

.TP
.B ZipTunPrefix
The prefix of the network on the other side of the tunnel. The Z/IP Gateway will send all packages with destination within this prefix through the tunnel.

.TP
.B ZipTunIp6PrefixLength
The length of the tunnel prefix.
Default: 128 

.TP
.B ZipManufacturerID
Id to set in the version report.
Default: 0

.TP
.B ZipHardwareVersion
Hardware version to set in the version report.
Default: 1

.TP
.B ZipProductID
Id to set in the version report.
Default: 1

.TP
.B ZipProductType
Id to set in the version report.
Default: 1

.TP
.B ZipMBPort
Destination port for Mailbox proxy.
Default: 41230 

.TP
.B ZipMBDestinationIp6 
IP of Mailbox proxy service.
Default: None

.TP
.B ZipMBMode
Mode of operation of Mailbox proxy

.nr step 0 1
Values:

.IP \n[step] 3
Disable the Mailbox
.IP \n+[step]
Use the Z/IP Gateway's own Mailbox functionality
.IP \n+[step]
Use a Mailbox proxy service to store Mailbox messages

Default: 1

.TP
.B ZipPSK 
Pre shared key used in DTLS connection.
Default: None 

.TP
.B ExtraClasses
A space separated set of command classes the Z/IP Gateway should present in its node info frame. Command class
numbers must be given in deciaml, or in hex preceding 0x, ie. 0x65.
Version command class get frames with one of these command classes will be forwarded to the unsolicited destination.

.SH SEE ALSO
.BR brctl (8),
.BR ip (8)
.SH AUTHORS
Sigma Designs
